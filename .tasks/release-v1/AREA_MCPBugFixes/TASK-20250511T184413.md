+++
id = "TASK-20250511T184413"
title = "Optimize MCP task_list Output Size"
type = "🌟 Feature"
status = "🟡 To Do"
priority = "🔼 High"
created_date = "2025-05-11"
updated_date = "2025-05-11"
assigned_to = ""
phase = "release-v1"
subdirectory = "AREA_MCPBugFixes"
+++

# Optimize MCP task_list Output Size

## Description ✍️

The current MCP `task_list` method returns the full content of each task, resulting in extremely large response sizes that exceed token limits for LLMs. When listing all tasks with Claude Code, the response from this method exceeds 37,000 tokens, making it impossible to retrieve a complete task list. The MCP server needs to be modified to return a more concise task representation by default, similar to how the CLI provides a summary view.

## Problem Analysis 🔍

Currently, the `task_list` method in `handlers.ts` returns complete task objects including:
- Full metadata (appropriate)
- Complete content (problematic for large responses)
- File paths (appropriate)

This causes several issues:
1. Token limit exceeded errors with LLMs
2. Unnecessary data transfer when only metadata is needed
3. Performance degradation when listing large numbers of tasks

The CLI version already uses a more concise format, focusing on metadata and omitting full content when displaying multiple tasks.

## Acceptance Criteria ✅

- [ ] Modify the MCP `task_list` method to return only metadata and file paths by default
- [ ] Add an optional `include_content` parameter (default: false) to request full content when needed
- [ ] Ensure backward compatibility with existing clients
- [ ] Add appropriate documentation for the modified behavior
- [ ] Support pagination for large result sets (nice to have)

## Implementation Plan 📝

1. **Modify `handlers.ts`**:
   - Update the `handleListTasks` function to accept an `include_content` parameter
   - Implement conditional content inclusion based on the parameter
   - Add logic to truncate or omit content in the default case

2. **Update MCP method schemas**:
   - Add the new parameter to MCP method type definitions
   - Ensure proper zod validation for the new parameter

3. **Update documentation**:
   - Add information about the parameter to tool descriptions
   - Update MCP SDK documentation with usage examples

## Implementation Notes 💭

The implementation should follow these principles:

1. **Default to Concise**: By default, omit content and return only metadata
2. **Opt-in for Full Content**: Allow clients to explicitly request full content
3. **Backward Compatibility**: Existing clients should continue to work
4. **Future Expansion**: Design with future pagination support in mind

Example API change:
```typescript
// Before
interface TaskListParams {
  status?: string;
  phase?: string;
  // other existing params
}

// After
interface TaskListParams {
  status?: string;
  phase?: string;
  include_content?: boolean; // Default: false
  // pagination params could be added in the future
  // other existing params
}
```

This approach maintains compatibility while providing a pathway to more efficient data transfer.

## Test Plan 🧪

- [ ] Test default behavior (without content)
- [ ] Test explicit content inclusion
- [ ] Test with various filter combinations
- [ ] Test with Claude Code to verify token limits are respected
- [ ] Verify backward compatibility with existing clients

