# Pre-Completion Code Review

<task>
You are a thorough code reviewer helping complete a task. Review the current work to ensure quality, security, and maintainability before marking the task as complete.
</task>

<context>
- This is a pre-v1 solo developer project
- Speed and pragmatism are important, but not at the expense of security or major bugs
- Scopecraft task hygiene must be maintained
- Focus on "good enough" quality that prevents regressions and maintains clarity
</context>

<task_identification>
1. Check if a task ID is provided: "$ARGUMENTS"
2. If the above is empty or just whitespace, attempt to identify the task:
   - Check git branch name for task ID pattern (e.g., feature/TASK-123)
   - Look for task ID in recent commit messages  
   - Use mcp__scopecraft-cmd__task_list with status=in_progress to find active task
   - If multiple candidates found, list them and ask user to specify
3. Once identified, retrieve task details with mcp__scopecraft-cmd__task_get
</task_identification>

<review_process>
1. **Run automated checks**
   - Execute: `bun run code-check`
   - Execute: `bun test` (if tests exist)
   - Verify all checks pass before proceeding

2. **Quick safety review**
   - Search for hardcoded credentials, API keys, or secrets
   - Check for console.log statements that should be removed
   - Verify no obvious security vulnerabilities (SQL injection, XSS)

3. **Feature verification**
   - Test that the implementation solves the intended problem
   - Quick manual test of related features to prevent regressions
   - Verify basic error paths don't crash the application

4. **Maintainability check**
   - Code clarity: Will this be understandable in 3 months?
   - TODO comments added for known improvements needed
   - Following existing project patterns and conventions
   - No unnecessary dependencies added

5. **Scopecraft task hygiene**
   - Implementation log is complete and accurate
   - All checklist items are marked complete or explicitly deferred
   - Task status is ready to transition to "Done"
   - Any follow-up tasks created and referenced

6. **Documentation check**
   - README updated if behavior changed
   - Breaking changes noted in task
   - Migration needs flagged if applicable
</review_process>

<instructions>
1. First, identify the task being reviewed using the value from <task_identification>
   - Use mcp__scopecraft-cmd__task_get to retrieve full task details
2. Run the automated checks and report their status
3. Perform the manual review steps, fixing minor issues as you go
4. For any issues found:
   - Fix immediately if trivial (typos, console.logs)
   - Add TODO comments for non-critical improvements
   - Create follow-up tasks for larger issues using mcp__scopecraft-cmd__task_create
5. Update the identified task with the review checklist using mcp__scopecraft-cmd__task_update
6. Prepare a final commit with review fixes if any were made
</instructions>

<output_format>
After completing the review, add this section to the task:

```markdown
## Pre-Completion Review
_Generated by `/project:review` on {date}_

### Safety Checks ✓
- [ ] `bun run code-check` passes
- [ ] All tests pass
- [ ] No hardcoded credentials
- [ ] Debug statements removed

### Feature Verification
- [ ] Implementation solves intended problem
- [ ] No regressions in related features
- [ ] Error paths handled gracefully

### Code Quality
- [ ] Code is clear and self-documenting
- [ ] TODOs added for future improvements
- [ ] Follows project patterns
- [ ] No unnecessary dependencies

### Scopecraft Hygiene
- [ ] Implementation log complete
- [ ] All checklist items addressed
- [ ] Status ready for completion
- [ ] Follow-up tasks created: {list task IDs}

### Changes Made During Review
{list any fixes made during review}

### Deferred for Later
{list items marked as TODO or created as follow-up tasks}

### Final Status
- [ ] Ready to mark task as complete
```
</output_format>

<example>
## Pre-Completion Review
_Generated by `/project:review` on 2025-05-17_

### Safety Checks ✓
- [x] `bun run code-check` passes
- [x] All tests pass
- [x] No hardcoded credentials
- [x] Debug statements removed

### Feature Verification
- [x] Implementation solves intended problem
- [x] No regressions in related features  
- [x] Error paths handled gracefully

### Code Quality
- [x] Code is clear and self-documenting
- [x] TODOs added for future improvements
- [x] Follows project patterns
- [x] No unnecessary dependencies

### Scopecraft Hygiene
- [x] Implementation log complete
- [x] All checklist items addressed
- [x] Status ready for completion
- [x] Follow-up tasks created: TASK-20250518-PERF, TASK-20250518-TEST

### Changes Made During Review
- Removed console.log statements in websocket-handler.ts
- Added null check in process-manager.ts:78
- Fixed TypeScript error in cli.ts:145
- Added TODO comment for performance optimization

### Deferred for Later
- Performance optimization for large datasets (→ TASK-20250518-PERF)
- Comprehensive error handling test suite (→ TASK-20250518-TEST)
- Refactoring of duplicate validation logic (TODO comment added)

### Final Status
- [x] Ready to mark task as complete
</example>

<final_action>
After completing the review and updating the task, provide a summary of:
1. What was reviewed
2. What was fixed
3. What was deferred
4. Whether the task is ready for completion
</final_action>

<!-- Usage (this section is not part of the prompt):
     With explicit task ID: /project:review TASK-20250517T185925
     Auto-detect from context: /project:review
-->